<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cal Poly NFPA Vehicle Challenge: HF Impulse</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cal Poly NFPA Vehicle Challenge
   &#160;<span id="projectnumber">Soulenoid Cycle, 2021.</span>
   </div>
   <div id="projectbrief">Support documentation for various mechatronics components on the vehicle.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('page2.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">HF Impulse </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The purpose of this page is to describe the software design for the ECDR 0506-A. The controller is programmed in HF Impuse, which is a configuration tool produced by Hydraforce. A screen capture of the HF Impulse software used for this project is shown below. This software was modified on 4/3/21, and may not be the exact version that is installed on the ECDR 0506-A. However, its general struture and layout has remained largely unchanged since 3/9/21, so it is still an effective reference image.</p>
<p><img src="https://raw.githubusercontent.com/jkochavi/Fluid-Power-Controller/master/wiki_Support_Files/Program4_3.png" alt="" style="width:1500px;" class="inline"/></p>
<p>The CANopen RX block is configured to receive a single, 1 digit number. This is accomplished by looking for a message that is 4 bits long. The settings for the CANopen RX block are shown in the image below. The ECDR 0506-A scans for a message with ID 385, or hex 181. It extracts 4 bits of data from the message, which is indicated by a specified data length of 4 bits. The start bit requires some trial and error, as it is still a little unclear as to how the ECDR parses a CANopen message. However, a start bit of 0 for this type of message has been confirmed to work well. Finally, the timeout block is set to its maximum value. After 65535 milliseconds (a little over a minute), the output of the RX block will revert to 0.</p>
<p><img src="https://raw.githubusercontent.com/jkochavi/Fluid-Power-Controller/master/wiki_Support_Files/Receive_PDO.png" alt="" style="width:400px;" class="inline"/></p>
<p>The CANopen TX block must be configured differently to transmit differently-sized data. To transmit an unsigned integer, ranging from 0 to 255, 8 bits of data are sent with the message ID of 385. In this case, the start bit is set to 8. Here, the message timeout has no effect on the transmitted message, so it has been set to 5 milliseconds. When a TX timeout occurs, it raises a timeout flag to the ECDR 0506-A's internal fault detection system.</p>
<p><img src="https://raw.githubusercontent.com/jkochavi/Fluid-Power-Controller/master/wiki_Support_Files/Transmit_PDO.png" alt="" style="width:400px;" class="inline"/></p>
<p>To transmit data larger than 8 bits, the CANopen TX block must be configured as shown below.</p>
<p><img src="https://raw.githubusercontent.com/jkochavi/Fluid-Power-Controller/master/wiki_Support_Files/16bitSend.png" alt="" style="width:400px;" class="inline"/></p>
<p>Note that the start bit was lowered to 0 from 8, and the data length is increased to 16 bits. This configuration was achieved through trial and error. Consider the decimal number 2800, which translates to the 16 bit hex number, 0AF0. The low byte of this two byte number is F0, and its high byte is 0A. When the ECDR transmits this number through its TX pin, it first sends the low byte, and then the high byte. Therefore, the received data will be inverted. In other words, if the low byte is the first byte of data received, it will be processed as the high byte of the message. This is reflected in the CAN monitor below.</p>
<p><img src="https://raw.githubusercontent.com/jkochavi/Fluid-Power-Controller/master/wiki_Support_Files/16bitMon.png" alt="" style="width:400px;" class="inline"/></p>
<p>Note how the message received reads F00A; the high byte of the decimal number, 2800, is received last. This inversion is corrected in the function, <a class="el" href="Interface_8cpp.html#ae7b4ba8037c51907ef76cdd1c2854fae" title="Function to read the accumulator pressure from the PLC.">CAN_readPressure()</a> by storing the high byte of the received message as the low byte of the stored data, and the visa versa.</p>
<dl class="section author"><dt>Author</dt><dd>Jordan Kochavi </dd></dl>
<dl class="section date"><dt>Date</dt><dd>April 4, 2021 </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
