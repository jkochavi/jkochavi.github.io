<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cal Poly NFPA Vehicle Challenge: Nextion Editor</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cal Poly NFPA Vehicle Challenge
   &#160;<span id="projectnumber">Soulenoid Cycle, 2021.</span>
   </div>
   <div id="projectbrief">Support documentation for various mechatronics components on the vehicle.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('page3.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Nextion Editor </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The purpose of this page is to describe the software design for the Nextion display. The display is programmed in Nextion Editor, which is a configuration tool produced by Nextion. The module has a single, two-wire UART port, which is used to program the display and communicate with the STM32 PCB. The module connects to Nextion Editor with a USB to Serial converter, which is shown in Figure 1 below.</p>
<p><img src="https://raw.githubusercontent.com/jkochavi/Fluid-Power-Controller/master/wiki_Support_Files/ttl.png" alt="" style="width:500px;" class="inline"/> <br  />
<b>Figure 1.</b> USB to serial converter used to program the Nextion display.</p>
<p>As shown above, this particular USB to Serial converter, which ships with the Nextion display has three switches. This allows the module to be used to convert USB to other forms of two-wire communication, such as RS-485 and TTL. To successfully connect to the Nextion, the switches on the USB to Serial converter must be toggled to the states shown in Figure 1: Switch 1 on, Switch 2 off, and the third switch directed away from the TTL label.</p>
<p>The table below describes the different variables and software objects used in the Nextion configuration file. Each object belows to the page that it was created on. Global variables can be accessed on any page and local variables can only be accessed on the page that it was defined on.</p>
<table style="float:left" border="border: 1px solid black">
<tr>
<th>Object Name </th><th>Type </th><th>Scope </th><th>Description  </th></tr>
<tr>
<td>page0.va0 </td><td>Variable </td><td>Global </td><td>Stores the current drive mode. Identical to buttonState in <a class="el" href="Interface_8cpp.html">Interface.cpp</a>, 1-&gt;Direct, 2-&gt;Coast, 3-&gt;Regen, 4-&gt;Boost, 5-&gt;Pedal. <br  />
  </td></tr>
<tr>
<td>page0.va1 </td><td>Variable </td><td>Global </td><td>Vehicle speed, in miles per hour, <em>integer form</em>. This value is used by the Plot page to chart speed vs. time.  </td></tr>
<tr>
<td>page0.tm0 </td><td>Timer </td><td>Local </td><td>This timer object has a period of 50 ms. Every 50 ms, the green bars for the speed and accumulator pressure are updated based on the current speed and pressure.  </td></tr>
<tr>
<td>page0.n0 </td><td>Number </td><td>Global </td><td>Accumulator pressure, in psi.  </td></tr>
<tr>
<td>page0.x0 </td><td>Float </td><td>Global </td><td>Vehicle speed, in miles per hour, <em>float form</em>. This value is only used on the home page to add resolution to the speed measurement.  </td></tr>
<tr>
<td>page4.tm0 </td><td>Timer </td><td>Local </td><td>This timer object has a period of 50 ms. It is used to update the waveform. Every 50 ms, the plot is updated with the current vehicle speed and the distance traveled is calculated.  </td></tr>
<tr>
<td>page4.va0 </td><td>Variable </td><td>Local </td><td>Stores the current vehicle speed <em>in integer form</em>, pulled from the value of page0.va1. This value must be reassigned to a local variable in order to correctly calculate distance traveled.  </td></tr>
<tr>
<td>page4.va1 </td><td>Variable </td><td>Local </td><td>Stores the intermediary calculation for change in distance traveled (see bullet point at the bottom of the page).  </td></tr>
<tr>
<td>page4.x0 </td><td>Float </td><td>Global </td><td>Distance traveled, in feet. As discussed in <a class="el" href="Interface_8cpp.html#a6d50525ab6bbea9007958d7feaf83360" title="Task which reads a hall effect sensor.">task_HALL1()</a>, this value is displayed to four decimal places solely as a result of calculating distance traveled, as the Nextion is incapable of floating point math.  </td></tr>
</table>
<p><br  />
 <br  />
 <br  />
 <br  />
 <br  />
 <br  />
</p>
<p>There are six pages in the Nextion interface (zero-indexed). The page IDs and descriptions are summarized in the table below. </p><table style="float:left" border="border: 1px solid black">
<tr>
<th>Page ID </th><th>Description  </th></tr>
<tr>
<td>page0 </td><td>Home screen and dashboard.  </td></tr>
<tr>
<td>page1 </td><td>Help screen. It shows a QR code that directs to this wiki.  </td></tr>
<tr>
<td>page2 </td><td>Drive mode switch board. Shows five virtual switches that change the vehicle's drive mode.  </td></tr>
<tr>
<td>page3 </td><td>Hydraulic circuit. Shows the manifold schematic and indicates which valves are currently energized.  </td></tr>
<tr>
<td>page4 </td><td>Plot. Shows a plot of vehicle speed vs. time, and displays distance traveled (only while viewing the Plot page).  </td></tr>
<tr>
<td>page5 </td><td>Animation. Shows a 3D orbit of the hydraulic vehicle.  <br  />
 </td></tr>
</table>
<p><br  />
 <br  />
 <br  />
 <br  />
 <br  />
 <br  />
 <br  />
 <br  />
</p>
<p><br  />
</p><ul>
<li>Since the Nextion display can't work with floating point numbers, we calculate distance traveled by multiplying by several factors of 10, and then shifting the decimal place of page4.x0 over appropriately. The change in distance traveled is calculated by multiplying the current vehicle speed by change in time, which is the update period of page4.tim0 (50 ms). Using the equation for distance traveled,</li>
</ul>
<p><img src="https://raw.githubusercontent.com/jkochavi/Fluid-Power-Controller/master/wiki_Support_Files/dx.png" alt="" style="width:300px" class="inline"/> <br  />
</p>
<p>page4.va0 is multiplied by 735 to calculate change in distance traveled x10^4. In order to return this variable to the correct magnitude, we shift the decimal point in the simulated floating point number, page4.x0, by 4, which appears to decrease its magnitude by 10000.</p>
<dl class="section author"><dt>Author</dt><dd>Jordan Kochavi </dd></dl>
<dl class="section date"><dt>Date</dt><dd>March 25, 2021 </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
