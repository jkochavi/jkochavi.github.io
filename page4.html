<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cal Poly NFPA Vehicle Challenge: Controller Area Network (CAN)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cal Poly NFPA Vehicle Challenge
   &#160;<span id="projectnumber">Soulenoid Cycle, 2021.</span>
   </div>
   <div id="projectbrief">Support documentation for various mechatronics components on the vehicle.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('page4.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Controller Area Network (CAN) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The purpose of this page is to describe the unique features of Controller Area Network and the higher level application protocol, CANopen. There are two basic layers to CAN communication: the physical layer, and the protocol. The physical layer required for popular CAN protocols, such as CANopen, J1939, and OBD-II, is CAN 2.0. This physical link is achieved with the MCP2515 CAN controller, which is designed to be compatible with CAN 2.0. The second component of the CAN physical layer is the transceiver. The transceiver used on the printed circuit board, described in <a class="el" href="index.html#s_hardware">Hardware Design</a>, is the TJA1050 CAN transceiver. Finally, a CAN bus must be terminated by a 120 ohm resistor, placed between the CAN high and low wires. In practice, this resistor is applied at the 'master' node. On the custom circuit board, described in <a class="el" href="index.html#s_hardware">Hardware Design</a>, there is a variable 120 ohm resistor, which can be toggled with a removable jumper pin. Additionally, the standard DB-9 connector commonly used with CAN may also contain a 120 ohm resistor. Below is the inside of DB-9 cable, which is attached to the ECDR 0506-A.</p>
<p><img src="https://raw.githubusercontent.com/jkochavi/Fluid-Power-Controller/master/wiki_Support_Files/DB9.png" alt="" style="width:200px;" class="inline"/> <br  />
<b>Figure 1.</b> Inside of a DB-9 CAN cable, revealing a 120 ohm termination resistor.</p>
<p>CANopen is a specific format for a message that is sent over a CAN bus. This allows different types devices to decode transmissions according to a universal method. Below, Figure 2 presents the contents of a CANopen message. Each rectangle represents 1 bit (either a 0 or 1).</p>
<p><img src="https://raw.githubusercontent.com/jkochavi/Fluid-Power-Controller/master/wiki_Support_Files/CANopenframe.png" alt="" style="width:400px;" class="inline"/> <br  />
<b>Figure 2.</b> CANopen frame contents (<a href="https://www.csselectronics.com/screen/page/canopen-tutorial-simple-intro/language/en"><b>source</b></a>).</p>
<p>In the CANopen protocol, the COB-ID corresponds to a unique type of message. There are several types of CANopen messages, but the ECDR 0506-A can only receive and transmit Process Data Objects (PDOs). PDOs are a type of message designed to maximize the data content in a CANopen message. For other message formats, the 'data' section, shown in blue in Figure 2, is filled with other flags, warnings, and codes. However, the PDO message reserves the entirety of the 64 bits (8 bytes) for data content. This makes PDOs suitable for transmitting actual data, such as measurements and calculations. In order to transmit a PDO message, the COB-ID must range between 385 and 511, which formally represents the 'PDO 1' data structure. In the CANopen protocol, there are 4 different PDO structures, which carry different ranges of COB-IDs. However, within the scope of sending and receiving simple messages to and from the ECDR 0506-A, PDO 1 is suitable.</p>
<p>Understanding how to assign a COB-ID for a PDO message is the extent of the knowledge about CANopen required to communicate with the ECDR 0506-A. <a href="https://www.csselectronics.com/screen/page/canopen-tutorial-simple-intro/language/en"><b>CSS Electronics</b></a> is an excellent source of additional information on the CANopen protocol.</p>
<p><img src="https://raw.githubusercontent.com/jkochavi/Fluid-Power-Controller/master/wiki_Support_Files/PLC.PNG" alt="" style="width:700px;" class="inline"/> <br  />
<b>Figure 3.</b> Decoding a CANopen message from the ECDR 0506-A.</p>
<p>To better understand the contents of a CANopen message, Figure 3 presents the readout from the ECDR 0506-A. The controller was configured to continuously output the number 3. It was connected to a Windows PC via a Kvaser Leaf Light, which is a USB to CAN interface that allows the ECDR 0506-A to be programmed from a PC environment. The Kvaser Leaf Light is compatible with Matlab's Vehicle Network Toolbox. This add-on has a CAN analyzer app, which allows the PC to scan and decode CAN messages. The output the analyzer is shown Figure 3. In HF Impulse, the message was sent in 2 bytes, with the COB-ID of 385. The decimal number, 385, translates to 0x181, in hexidecimal. Shown in the 'ID' section of the analyzer, we see the COB-ID of 0x181 is received by Matlab. In addition, we see the data length obtained by Matlab as 2 bytes. Finally, we see the contents of the message, which is just the number 3. For more information on how the ECDR 0506-A was configured to send a CANopen message, refer to <a class="el" href="page2.html">HF Impulse</a>.</p>
<dl class="section author"><dt>Author</dt><dd>Jordan Kochavi </dd></dl>
<dl class="section date"><dt>Date</dt><dd>March 4, 2021 </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
