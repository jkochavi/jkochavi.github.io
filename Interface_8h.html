<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cal Poly NFPA Vehicle Challenge: Interface.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cal Poly NFPA Vehicle Challenge
   &#160;<span id="projectnumber">Soulenoid Cycle, 2021.</span>
   </div>
   <div id="projectbrief">Support documentation for various mechatronics components on the vehicle.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('Interface_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Interface.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;Arduino.h&quot;</code><br />
<code>#include &quot;PrintStream.h&quot;</code><br />
<code>#include &quot;STM32FreeRTOS.h&quot;</code><br />
</div>
<p><a href="Interface_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a86720ded03b3f5b5ca53d30b33cb33bb"><td class="memItemLeft" align="right" valign="top"><a id="a86720ded03b3f5b5ca53d30b33cb33bb"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Interface_8h.html#a86720ded03b3f5b5ca53d30b33cb33bb">DIRECT</a>&#160;&#160;&#160;1</td></tr>
<tr class="memdesc:a86720ded03b3f5b5ca53d30b33cb33bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Macro definition for direct drive button state. <br  />
 <br /></td></tr>
<tr class="separator:a86720ded03b3f5b5ca53d30b33cb33bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20291e995fad7806c119183b4717f3f8"><td class="memItemLeft" align="right" valign="top"><a id="a20291e995fad7806c119183b4717f3f8"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Interface_8h.html#a20291e995fad7806c119183b4717f3f8">COAST</a>&#160;&#160;&#160;2</td></tr>
<tr class="memdesc:a20291e995fad7806c119183b4717f3f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Macro definition for coast mode button state. <br /></td></tr>
<tr class="separator:a20291e995fad7806c119183b4717f3f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11b3b506179458dd29a9fbded3921e05"><td class="memItemLeft" align="right" valign="top"><a id="a11b3b506179458dd29a9fbded3921e05"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Interface_8h.html#a11b3b506179458dd29a9fbded3921e05">REGEN</a>&#160;&#160;&#160;3</td></tr>
<tr class="memdesc:a11b3b506179458dd29a9fbded3921e05"><td class="mdescLeft">&#160;</td><td class="mdescRight">Macro definition for regenerative braking button state. <br /></td></tr>
<tr class="separator:a11b3b506179458dd29a9fbded3921e05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab97dfc84158d22d16e762f46c754176c"><td class="memItemLeft" align="right" valign="top"><a id="ab97dfc84158d22d16e762f46c754176c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Interface_8h.html#ab97dfc84158d22d16e762f46c754176c">BOOST</a>&#160;&#160;&#160;4</td></tr>
<tr class="memdesc:ab97dfc84158d22d16e762f46c754176c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Macro definition for boost mode button state. <br /></td></tr>
<tr class="separator:ab97dfc84158d22d16e762f46c754176c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00b776b8d8a7f1e9d409d44bb9a74fe6"><td class="memItemLeft" align="right" valign="top"><a id="a00b776b8d8a7f1e9d409d44bb9a74fe6"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Interface_8h.html#a00b776b8d8a7f1e9d409d44bb9a74fe6">PEDAL</a>&#160;&#160;&#160;5</td></tr>
<tr class="memdesc:a00b776b8d8a7f1e9d409d44bb9a74fe6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Macro definition for pedal charge button state. <br /></td></tr>
<tr class="separator:a00b776b8d8a7f1e9d409d44bb9a74fe6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf89dc0b59b9b73438c94f07495c7076"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Interface_8h.html#acf89dc0b59b9b73438c94f07495c7076">CAN_ERROR</a>&#160;&#160;&#160;9999</td></tr>
<tr class="memdesc:acf89dc0b59b9b73438c94f07495c7076"><td class="mdescLeft">&#160;</td><td class="mdescRight">Macro definition for CAN error code.  <a href="Interface_8h.html#acf89dc0b59b9b73438c94f07495c7076">More...</a><br /></td></tr>
<tr class="separator:acf89dc0b59b9b73438c94f07495c7076"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a893d3a3d7fa66dfbcd339edf68853f10"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Interface_8h.html#a893d3a3d7fa66dfbcd339edf68853f10">CAN_OTHER</a>&#160;&#160;&#160;9998</td></tr>
<tr class="memdesc:a893d3a3d7fa66dfbcd339edf68853f10"><td class="mdescLeft">&#160;</td><td class="mdescRight">Macro definition for diagnosing other tranmsission errors.  <a href="Interface_8h.html#a893d3a3d7fa66dfbcd339edf68853f10">More...</a><br /></td></tr>
<tr class="separator:a893d3a3d7fa66dfbcd339edf68853f10"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9e8d440b9f80517890c8ebe462ed9bfb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Interface_8h.html#a9e8d440b9f80517890c8ebe462ed9bfb">task_display</a> (void *params)</td></tr>
<tr class="memdesc:a9e8d440b9f80517890c8ebe462ed9bfb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Task which interacts with the Nextion display.  <a href="Interface_8h.html#a9e8d440b9f80517890c8ebe462ed9bfb">More...</a><br /></td></tr>
<tr class="separator:a9e8d440b9f80517890c8ebe462ed9bfb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2799bc5582d595c9af523f6c05e59d03"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Interface_8h.html#a2799bc5582d595c9af523f6c05e59d03">task_CAN</a> (void *params)</td></tr>
<tr class="memdesc:a2799bc5582d595c9af523f6c05e59d03"><td class="mdescLeft">&#160;</td><td class="mdescRight">Task which interacts with the CAN bus.  <a href="Interface_8h.html#a2799bc5582d595c9af523f6c05e59d03">More...</a><br /></td></tr>
<tr class="separator:a2799bc5582d595c9af523f6c05e59d03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fb62abab955d8de99b1f66afc818b93"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Interface_8h.html#a4fb62abab955d8de99b1f66afc818b93">task_HALL1</a> (void *params)</td></tr>
<tr class="memdesc:a4fb62abab955d8de99b1f66afc818b93"><td class="mdescLeft">&#160;</td><td class="mdescRight">Task which reads a hall effect sensor.  <a href="Interface_8h.html#a4fb62abab955d8de99b1f66afc818b93">More...</a><br /></td></tr>
<tr class="separator:a4fb62abab955d8de99b1f66afc818b93"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This is the header file for the inteface task functions. </p><dl class="section author"><dt>Author</dt><dd>Jordan Kochavi </dd></dl>
<dl class="section date"><dt>Date</dt><dd>8 Dec 2020 Original file </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="acf89dc0b59b9b73438c94f07495c7076"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf89dc0b59b9b73438c94f07495c7076">&#9670;&nbsp;</a></span>CAN_ERROR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CAN_ERROR&#160;&#160;&#160;9999</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Macro definition for CAN error code. </p>
<p>If a message is unable to be received from the ECDR 0506-A, then the CAN task will assign the stored message variable as this error code. This is used to alert the user if an error has occured in the CAN transmision. </p>

</div>
</div>
<a id="a893d3a3d7fa66dfbcd339edf68853f10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a893d3a3d7fa66dfbcd339edf68853f10">&#9670;&nbsp;</a></span>CAN_OTHER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CAN_OTHER&#160;&#160;&#160;9998</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Macro definition for diagnosing other tranmsission errors. </p>
<p>When debugging CAN transmission problems, it is sometimes helpful to determine if the physical connection is the problem, or if the problem is software-related. The CAN_ERROR message is used to diagnose hardware problems, either with the physical CAN wires or the MCP2515. This message is used if there isn't a problem with the physical link, but a different message was received from what the CAN task was looking for. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a2799bc5582d595c9af523f6c05e59d03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2799bc5582d595c9af523f6c05e59d03">&#9670;&nbsp;</a></span>task_CAN()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void task_CAN </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Task which interacts with the CAN bus. </p>
<p>This task sends the current user-chosen drive mode to the PLC and reads the accumulator pressure, using the CAN bus. We interface with the CAN bus using an MCP2515 controller. On the custom PCB, the MCP2515 controller uses an 8 MHz crystal to clock the CAN bitrate. However, the mcp2515.cpp and mcp2515.h files clock the bitrate using a 16 MHz crystal. This parameter was altered in those files to set the correct bitrate.</p>
<p><img src="https://raw.githubusercontent.com/jkochavi/Fluid-Power-Controller/master/wiki_Support_Files/setBitrate.png" alt="" style="width:300px;" class="inline"/></p>
<p>The image above captures the function, setBitrate(), which is part of the MCP2515 library written by GitHub user <em>autowp</em>. The second argument provided to the function represents the type of oscillator used with the MCP2515 integrated-circuit. By default, this value is 16 MHz. However, the PCB designed for this project uses an 8 MHz crystal instead of a 16 MHz one. To establish the correct communication speed on the CAN bus, this parameter must be changed to MCP_8MHZ, as outlined in red in the image above. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_params</td><td>A pointer to function parameters which we don't use. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9e8d440b9f80517890c8ebe462ed9bfb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e8d440b9f80517890c8ebe462ed9bfb">&#9670;&nbsp;</a></span>task_display()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void task_display </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Task which interacts with the Nextion display. </p>
<p>This task updates various data on the Nextion, which includes the accumulator pressure and the speed of the vehicle. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_params</td><td>A pointer to function parameters which we don't use. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4fb62abab955d8de99b1f66afc818b93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fb62abab955d8de99b1f66afc818b93">&#9670;&nbsp;</a></span>task_HALL1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void task_HALL1 </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Task which reads a hall effect sensor. </p>
<p>This task polls the GPIO pin for the hall effect sensor. Whenever the triggers low, the task retains the elapsed time, in milliseconds, between pulses. We use the circumference of the wheel to calculate the distance traveled between pulses, and then divide by the time between pulses to calculate speed, which is subsequently converted to miles per hour. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_params</td><td>A pointer to function parameters which we don't use. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="Interface_8h.html">Interface.h</a></li>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
